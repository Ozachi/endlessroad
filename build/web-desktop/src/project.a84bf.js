require=function e(t,i,o){function n(a,c){if(!i[a]){if(!t[a]){var r="function"==typeof require&&require;if(!c&&r)return r(a,!0);if(s)return s(a,!0);var d=new Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d}var h=i[a]={exports:{}};t[a][0].call(h.exports,function(e){var i=t[a][1][e];return n(i||e)},h,h.exports,e,t,i,o)}return i[a].exports}for(var s="function"==typeof require&&require,a=0;a<o.length;a++)n(o[a]);return n}({background:[function(e,t,i){"use strict";cc._RF.push(t,"ad41c/xVbdPkbW3QvzF211v","background"),cc.Class({extends:cc.Component,properties:{near_bg:[cc.Node],far_bg:[cc.Node],near_speed:5,far_speed:.5},onLoad:function(){this.fixBgPos(this.far_bg[0],this.far_bg[1]),this.fixBgPos(this.near_bg[0],this.near_bg[1])},fixBgPos:function(e,t){e.x=0;var i=e.getBoundingBox();t.setPosition(i.xMax,i.yMin)},update:function(e){this.bgMove(this.far_bg,this.far_speed),this.bgMove(this.near_bg,this.near_speed),this.checkBgReset(this.far_bg),this.checkBgReset(this.near_bg)},bgMove:function(e,t){for(var i=0;i<e.length;i++)e[i].x-=t},checkBgReset:function(e){cc.director.getWinSize();if(e[0].getBoundingBox().xMax<=0){var t=e.shift();e.push(t);var i=e[0];t.x=i.getBoundingBox().xMax}}}),cc._RF.pop()},{}],control_layer:[function(e,t,i){"use strict";cc._RF.push(t,"f752c9ekMVAcq5XLn/RhLEf","control_layer");var o=e("panda_control");cc.Class({extends:cc.Component,properties:{panda:{default:null,type:o}},onClickJump:function(e){e.getLocation().x>e.currentTarget.width/2&&cc.find("Canvas/game_layer/panda").getComponent("panda_control").jump()},onLoad:function(){}}),cc._RF.pop()},{panda_control:"panda_control"}],"game-scene":[function(e,t,i){"use strict";cc._RF.push(t,"facf018is5ERKFkFWa/fWq7","game-scene"),cc.Class({extends:cc.Component,properties:{platform_generator:null,platform_default_0:cc.Node,platform_default_1:cc.Node},onLoad:function(){var e=cc.find("platform-generator");this.platform_generator=e.getComponent("platform-generator"),this.platform_generator.initPlatforms([this.platform_default_0,this.platform_default_1])}}),cc._RF.pop()},{}],joy_stick:[function(e,t,i){"use strict";cc._RF.push(t,"3a1b7XhV/NGoLdgCU49bJlk","joy_stick"),cc.Class({extends:cc.Component,properties:{joyStick:{default:null,type:cc.Node},joyCenter:{default:null,type:cc.Node},radius:0},onTouchStart:function(e){var t=e.getLocation(),i=e.currentTarget.joyStick;t=i.parent.convertToNodeSpaceAR(t),i.position=t,i.active=!0},onTouchMove:function(e){var t=e.getLocation(),i=e.currentTarget,o=e.currentTarget.joyCenter,n=e.currentTarget.joyStick,s=i.convertToNodeSpaceAR(t),a=e.currentTarget.radius,c=Math.sqrt(Math.pow(s.x-n.x,2)+Math.pow(s.y-n.y,2)),r=n.convertToNodeSpaceAR(t);if(c>a){var d=cc.v2(r.x,r.y);d.normalizeSelf(),d.mulSelf(a/n.scale),o.position=d}else o.position=r;cc.find("Canvas/game_layer/panda").getComponent("panda_control").direction=o.x>=0?1:-1},onTouchend:function(e){var t=e.currentTarget.joyCenter;t.x=0,t.y=0,e.currentTarget.joyStick.active=!1,cc.find("Canvas/game_layer/panda").getComponent("panda_control").direction=0},onLoad:function(){this.radius=this.joyStick.getContentSize().width/2*this.joyStick.scale,this.node.radius=this.radius,this.node.joyStick=this.joyStick,this.node.joyCenter=this.joyCenter,this.joyStick.active=!1,this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this.node),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this.node),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchend,this.node),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchend,this.node)}}),cc._RF.pop()},{}],panda_control:[function(e,t,i){"use strict";cc._RF.push(t,"d5100S4m6ROAJ4FE6j+WaBp","panda_control"),cc.Class({extends:cc.Component,properties:{speed:cc.v2(0,0),addSpeed:600,maxSpeed:cc.v2(10,1e3),gravity:-1e3,jumpSpeed:300,collisionX:0,collisionY:0,direction:0,jumping:!1,jumpCount:0,drag:1e3,prePosition:cc.v2(0,0),player:null,uiLayer:cc.Node,uiLayerComonent:null,winSize:null},onLoad:function(){this.prePosition.x=this.node.x,this.prePosition.y=this.node.y,cc.director.getCollisionManager().enabled=!0,this.player=this.node.getComponent(cc.Animation),this.uiLayerComonent=this.uiLayer.getComponent("uiLayer"),this.winSize=cc.director.getWinSize(),cc.eventManager.addListener({event:cc.EventListener.KEYBOARD,onKeyPressed:this.onKeyPressed.bind(this),onKeyReleased:this.onKeyReleased.bind(this)},this.node)},onDestroy:function(){cc.director.getCollisionManager().enabled=!1,cc.director.getCollisionManager().enabledDebugDraw=!1},onKeyPressed:function(e,t){switch(e){case cc.KEY.d:this.direction=1,this.jumping||this.player.play("run");break;case cc.KEY.a:this.direction=-1,this.jumping||this.player.play("run");break;case cc.KEY.j:(!this.jumping||this.jumpCount<2)&&(this.jumping=!0,this.speed.y=this.jumpSpeed,++this.jumpCount<2?this.player.play("jump"):this.player.play("twiceJump"))}},jump:function(){(!this.jumping||this.jumpCount<2)&&(this.jumping=!0,this.speed.y=this.jumpSpeed,++this.jumpCount<2?this.player.play("jump"):this.player.play("twiceJump"))},onKeyReleased:function(e,t){switch(e){case cc.KEY.d:1==this.direction&&(this.direction=0);break;case cc.KEY.a:-1==this.direction&&(this.direction=0)}},collisionGoldEnter:function(e,t){e.node.removeFromParent(),this.uiLayerComonent.addGold()},collisionPlatformEnter:function(e,t){var i=t.world.aabb.clone(),o=e.world.aabb,n=t.world.preAabb;if(i.x=n.x,i.y=n.y,i.x=t.world.aabb.x,cc.Intersection.rectRect(i,o))return this.speed.x<0&&i.xMax>o.xMax?(this.node.x=o.xMax,this.collisionX=-1):this.speed.x>0&&i.xMin<o.xMin&&(this.node.x=o.xMin-i.width,this.collisionX=1),void(this.speed.x=0);i.y=t.world.aabb.y,cc.Intersection.rectRect(i,o)&&(this.speed.y<0&&i.yMax>o.yMax?(this.node.y=o.yMax,this.jumping=!1,this.player.play("run"),this.jumpCount=0,this.collisionY=-1):this.speed.y>0&&i.yMin<o.yMin&&(this.node.y=o.yMin-i.height,this.collisionY=1),this.speed.y=0)},onCollisionEnter:function(e,t){console.log("on collision enter"),cc.log("coll tag = "+e.tag),1==e.tag?this.collisionGoldEnter(e,t):this.collisionPlatformEnter(e,t)},onCollisionStay:function(e,t){},onCollisionExit:function(e,t){console.log("on collision exit"),0==e.tag&&(this.collisionX=0,this.collisionY=0,this.jumping=!0,this.jumpCount=1,this.player.play("jump"))},update:function(e){if(0===this.collisionY&&(this.speed.y+=this.gravity*e,Math.abs(this.speed.y)>this.maxSpeed.y&&(this.speed.y=this.speed.y>0?this.maxSpeed.y:-this.maxSpeed.y)),0===this.direction)this.speed.x>0?(this.speed.x-=this.drag*e,this.speed.x<=0&&(this.speed.x=0)):this.speed.x<0&&(this.speed.x+=this.drag*e,this.speed.x>=0&&(this.speed.x=0));else{var t=this.speed.x>0?1:-1;0==this.speed.x&&(t=0);var i=t==this.direction?this.addSpeed:3e3;this.speed.x+=(this.direction>0?1:-1)*i*e,Math.abs(this.speed.x)>this.maxSpeed.x&&(this.speed.x=this.speed.x>0?this.maxSpeed.x:-this.maxSpeed.x)}if(this.speed.x*this.collisionX>0&&(this.speed.x=0),this.prePosition.x=this.node.x,this.prePosition.y=this.node.y,this.node.x+=this.speed.x*e,this.node.y+=this.speed.y*e,this.node.y+this.node.height<0)return this.uiLayerComonent.showEnd(),void this.node.removeFromParent();this.node.x+this.node.width>this.winSize.width?this.node.x=this.winSize.width-this.node.width:this.node.x<0&&(this.node.x=0)}}),cc._RF.pop()},{}],"platform-generator":[function(e,t,i){"use strict";cc._RF.push(t,"a5b85M16A9GbZoyKP97bDi4","platform-generator");var o=e("uiLayer");cc.Class({extends:cc.Component,properties:{platform_list:[],move_speed:.1,platform_prafab:[cc.Prefab],platform_layer:cc.Node,gold_group_list:[cc.Prefab],maxMoveSpeed:8,uiLayer:{default:null,type:o}},initPlatforms:function(e){this.platform_list=e,e.forEach(function(e){e.setAnchorPoint(0,0)},this)},generate:function(e){var t=4*Math.random();t=Math.floor(t);var i=cc.instantiate(this.platform_prafab[t]);i.setAnchorPoint(0,0);var o=this.platform_layer.getContentSize();i.x=o.width,i.y=Math.random()*(o.height-100),cc.log(i.y);i.y>e.y+100&&(i.y=e.y+100),this.platform_list.push(i),this.platform_layer.addChild(i);var n=3*Math.random();n=Math.floor(n);var s=cc.instantiate(this.gold_group_list[n]),a=i.getContentSize();s.setPosition(a.width/2,a.height),i.addChild(s),cc.log("产出一个平台,平台数=",this.platform_list.length)},update:function(e){for(var t,i=[],o=0;o<this.platform_list.length;o++)(t=this.platform_list[o]).x-=this.move_speed,t.getBoundingBox().xMax>0?i.push(t):t.removeFromParent();if(this.platform_list=i,this.uiLayer.addDistance(this.move_speed),t){var n=cc.director.getWinSize(),s=t.getBoundingBox();s.x+s.width<.8*n.width&&this.generate(t),this.move_speed<this.maxMoveSpeed&&(this.move_speed+=.001)}}}),cc._RF.pop()},{uiLayer:"uiLayer"}],uiLayer:[function(e,t,i){"use strict";cc._RF.push(t,"68c90r5ql1P0ppR4qeTEULM","uiLayer"),cc.Class({extends:cc.Component,properties:{gold_label:cc.Label,end_ui_prefab:cc.Prefab,goldNum:0,disNum:0,disLabel:cc.Label},onLoad:function(){},addGold:function(){this.goldNum++,this.gold_label.string=this.goldNum+""},addDistance:function(e){this.disNum+=e,this.disNum*=.8,this.disNum=Math.floor(this.disNum),this.disLabel.string="行走距离："+this.disNum},showEnd:function(){var e=cc.instantiate(this.end_ui_prefab);e.setPosition(this.node.width/2,this.node.height/2),e.getChildByName("gold_label").getComponent(cc.Label).string=this.gold_label.string,e.getChildByName("distance_label").getComponent(cc.Label).string=this.disNum,this.node.addChild(e)}}),cc._RF.pop()},{}]},{},["background","control_layer","joy_stick","uiLayer","panda_control","platform-generator","game-scene"]);