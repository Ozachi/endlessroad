{"version":3,"sources":["move-control.js"],"names":["cc","Class","extends","Component","properties","_left","_right","_up","_down","_jumping","jumpY","speedX","_speedY","g","_leftBlock","_rightBlock","_upBlock","_downBlock","_anim","_animState","onLoad","getComponent","Animation","systemEvent","on","onKeyDown","onKeyUp","manager","director","getCollisionManager","enabled","onInventedKeyEvent","self","find","Node","EventType","TOUCH_START","event","node","scaleX","changeAnim","TOUCH_END","onCollisionEnter","other","group","loadScene","blockArray","selfAabb","world","aabb","otherAabb","selfPreAabb","preAabb","otherPreAabb","xMax","xMin","worldPositionX","center","x","Math","abs","parent","convertToNodeSpaceAR","v2","push","yMax","yMin","worldPositionY","y","blockArrays","undefined","name","onCollisionExit","item","e","keyCode","KEY","a","d","j","stop","play","update","dt","currentSpeedY","min"],"mappings":"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","file":"move-control.js","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        _left: false,\r\n        _right: false,\r\n        _up: false,\r\n        _down: false,\r\n\r\n        _jumping: false,\r\n        jumpY: 40,\r\n        speedX: 5,\r\n        _speedY: 0,\r\n        g: -10,\r\n\r\n        _leftBlock: 0,\r\n        _rightBlock: 0,\r\n        _upBlock: 0,\r\n        _downBlock: 0,\r\n\r\n        _anim: null,\r\n        _animState : null,\r\n    },\r\n\r\n    onLoad: function () {\r\n        this._anim = this.getComponent(cc.Animation);\r\n        cc.systemEvent.on('keydown',this.onKeyDown,this);\r\n        cc.systemEvent.on('keyup',this.onKeyUp,this);\r\n\r\n        let manager = cc.director.getCollisionManager();\r\n        manager.enabled = true;\r\n\r\n        this.onInventedKeyEvent();\r\n    },\r\n\r\n    onInventedKeyEvent:function(){\r\n        var self=this\r\n        cc.find(\"Canvas/LeftBottom/goleft\").on(cc.Node.EventType.TOUCH_START, function (event) {\r\n            self._left = true;\r\n            self.node.scaleX = -1;\r\n            self.changeAnim();\r\n        });\r\n        cc.find(\"Canvas/LeftBottom/goleft\").on(cc.Node.EventType.TOUCH_END, function (event) {\r\n            self._left = false;\r\n            self.changeAnim();\r\n        });\r\n        cc.find(\"Canvas/LeftBottom/goright\").on(cc.Node.EventType.TOUCH_START, function (event) {\r\n            self._right = true;\r\n            self.node.scaleX = 1;\r\n            self.changeAnim();\r\n        });\r\n        cc.find(\"Canvas/LeftBottom/goright\").on(cc.Node.EventType.TOUCH_END, function (event) {\r\n            self._right = false;\r\n            self.changeAnim();\r\n        });\r\n        cc.find(\"Canvas/RightBottom/gojump\").on(cc.Node.EventType.TOUCH_START, function (event) {\r\n            self._up = true;\r\n            self._jumping = true;\r\n            self.changeAnim();\r\n        });\r\n    },\r\n\r\n    onCollisionEnter: function(other,self){\r\n        if(other.node.group == 'door'){\r\n            cc.director.loadScene(\"Game\")\r\n        }\r\n        if(other.node.group=='wall'){\r\n            let blockArray = [];\r\n            let selfAabb = self.world.aabb;\r\n            let otherAabb = other.world.aabb;\r\n            let selfPreAabb = self.world.preAabb;\r\n            let otherPreAabb = other.world.preAabb;\r\n\r\n            if(selfPreAabb.xMax <= otherAabb.xMin && selfAabb.xMax >= otherAabb.xMin){\r\n                //right block\r\n                //console.log('right');\r\n                let worldPositionX = selfAabb.center.x - Math.abs(otherAabb.xMin - selfAabb.xMax);\r\n                this.node.x = this.node.parent.convertToNodeSpaceAR(cc.v2(worldPositionX,0)).x;\r\n                blockArray.push(\"_rightBlock\");\r\n                this._rightBlock++;\r\n            }\r\n            if(selfPreAabb.xMin >= otherAabb.xMax && selfAabb.xMin <= otherAabb.xMax){\r\n                //left block\r\n                //console.log('left');\r\n                let worldPositionX = selfAabb.center.x  +  Math.abs(otherAabb.xMax - selfAabb.xMin);\r\n                this.node.x = this.node.parent.convertToNodeSpaceAR(cc.v2(worldPositionX,0)).x;\r\n                blockArray.push(\"_leftBlock\");\r\n                this._leftBlock++;\r\n            }\r\n            if(selfPreAabb.yMax <= otherAabb.yMin && selfAabb.yMax >= otherAabb.yMin){\r\n                //up block\r\n                //console.log('up');\r\n                let worldPositionY = selfAabb.center.y - Math.abs(otherAabb.yMin - selfAabb.yMax);\r\n                this.node.y = this.node.parent.convertToNodeSpaceAR(cc.v2(0,worldPositionY)).y;\r\n                blockArray.push(\"_upBlock\");\r\n                this._upBlock++;\r\n            }\r\n            if(selfPreAabb.yMin >= otherAabb.yMax && selfAabb.yMin <= otherAabb.yMax){\r\n                //down block\r\n                //console.log('down');\r\n                let worldPositionY = selfAabb.center.y + Math.abs(otherAabb.yMax - selfAabb.yMin);\r\n                this.node.y = this.node.parent.convertToNodeSpaceAR(cc.v2(0,worldPositionY)).y;\r\n                blockArray.push(\"_downBlock\");\r\n                this._jumping = false;\r\n                this._downBlock++;\r\n            }\r\n\r\n            if(other.blockArrays == undefined){\r\n                other.blockArrays = [];\r\n            }\r\n            other.blockArrays[this.node.name] = blockArray;\r\n        }\r\n        \r\n    },\r\n\r\n\r\n\r\n    onCollisionExit: function(other,self){\r\n        if(other.blockArrays && other.blockArrays[this.node.name] != undefined){\r\n            let blockArray = other.blockArrays[this.node.name]\r\n            for(let item of blockArray){\r\n                this[item]--;\r\n            }\r\n        }\r\n    },\r\n\r\n    onKeyDown: function(e){\r\n        switch(e.keyCode){//离奇bug \r\n            case cc.KEY.a: {this._left = true;this.node.scaleX = -1;break;}\r\n            case cc.KEY.d: {this._right = true;this.node.scaleX = 1;break;}\r\n            case cc.KEY.j: {this._up = true;this._jumping = true;break;}\r\n        };\r\n        this.changeAnim();\r\n    },\r\n\r\n    onKeyUp: function(e){\r\n        switch(e.keyCode){\r\n            case cc.KEY.a: {this._left = false;break;}\r\n            case cc.KEY.d: {this._right = false;break;}\r\n            //case cc.KEY.up: {this._up = false;this._jumping = true;break;}\r\n        }\r\n        this.changeAnim();\r\n    },\r\n\r\n    changeAnim: function(){\r\n        //check jump\r\n        if(this._jumping){\r\n            if(!this._animState || this._animState.name !== 'jump'){\r\n                this._anim.stop();\r\n                this._animState = this._anim.play('jump');\r\n            }\r\n        }\r\n        //check move\r\n        else if(this._left == false && this._right == true ||\r\n           this._left == true && this._right == false){\r\n               if(!this._animState || this._animState.name !== 'move'){\r\n                    this._anim.stop();\r\n                    this._animState = this._anim.play('move');\r\n               }\r\n           }\r\n        //check idle\r\n        else if(this._left == false && this._right == false ||\r\n                this._left == true && this._right == true){\r\n                    if(!this._animState || this._animState.name !== 'idle'){\r\n                        this._anim.stop();\r\n                        this._animState = this._anim.play('idle');\r\n                    }\r\n                }\r\n    },//等会简单演示下帧动画的制作吧。。\r\n\r\n\r\n    update: function(dt){\r\n        if(this._left && !this._leftBlock){this.node.x -= this.speedX};\r\n        if(this._right && !this._rightBlock){this.node.x += this.speedX};\r\n        \r\n        if(!this._downBlock){\r\n            this._speedY += this.g * dt;\r\n        }else{\r\n            this._speedY = 0;\r\n            this._jumping = false;\r\n            this.changeAnim();\r\n        }\r\n        if(this._up){\r\n            this._speedY = this.jumpY;\r\n            this._up = false;\r\n            this._jumping = true;\r\n        }\r\n        let currentSpeedY = this._speedY;\r\n        if(this._upBlock){\r\n            currentSpeedY = Math.min(this._speedY,0);\r\n            this._speedY=0\r\n        }\r\n        this.node.y += currentSpeedY * dt;\r\n    }\r\n\r\n});\r\n"]}